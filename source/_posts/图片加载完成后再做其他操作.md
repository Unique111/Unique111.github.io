---
title: 图片加载完成后再做其他操作
date: 2017-09-11
categories: ['javascript']
tags:
---
有时候，我们需要在页面的图片加载完成后再执行某些操作，例如：瀑布流。

判断图片是否加载完成的方法：

<!-- more -->

### onload事件
通过监听图片的onload事件，可以判断图片是否已经加载完成，兼容所有的浏览器（w3c推荐方法）。
``` javascript
// 原生javascript
document.getElementById('img1').onload = function(e) {
  e.stopPropagation();
  alert(1);
};
// jQuery
$('.photo-img').each(function() {
  var img = new Image($(this));
  img.onload = function() {
    photoNum--;
    if (!photoNum && pageType === 1 && photoLen) {
      waterfall('.photo-wrap');
    }
  };
  img.src = $(this).attr('src');
});
```

### 判断img对象（DOM）的complete属性
当img加载完成之后，complete对象属性将变为true。此方法也是兼容所有浏览器。
``` javascript
var timer = setInterval(function() {
  if (document.getElementById('img1').complete){
    clearInterval(timer);
    alert(1);
    console.log(document.getElementById('img1').complete);
  }
}, 10);
```

### onreadystatechange事件
在ie下，img对象与xhr对象一样具有onreadystatechange事件，可以通过绑定该事件判断图片是否加载完成。此方法仅在IE下可用。
``` javascript
document.getElementById('img1').onreadystatechange = function() {
  var readyState = document.getElementById('img1').readyState;
  if(readyState == 'complete' || readyState == 'loaded') {
    alert(1);
  }
}
```

















